Homework 5
================
Cong Zhang
2020-11-18

This is my solution to Homework 5.

## Problem 1

Read in the data.

``` r
homicide_df = 
  read_csv("homicide_data/homicide-data.csv") %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL")
```

Let’s look at this a bit

``` r
aggregate_df = 
  homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    hom_total = n(),
    hom_unsolved = sum(resolved == "unsolved")
  )
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

Can I do a prop test for a single city?

``` r
prop.test(
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_unsolved), 
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_total)) %>% 
  broom::tidy()
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample~ two.sided

Try to iterate …

``` r
results_df = 
  aggregate_df %>% 
  mutate(
    prop_tests = map2(.x = hom_unsolved, .y = hom_total, ~prop.test(x = .x, n = .y)),
    tidy_tests = map(.x = prop_tests, ~broom::tidy(.x))
  ) %>% 
  select(-prop_tests) %>% 
  unnest(tidy_tests) %>% 
  select(city_state, estimate, conf.low, conf.high)
```

``` r
results_df %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

<img src="p8105_hw5_cz2612_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

``` r
city_prop_test = function(df) {

}

homicide_df = 
  read_csv("homicide_data/homicide-data.csv") %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL") %>% 
  nest(data = resolved)
```

## Problem 2

Read in data for each subject with `map` function and save the result as
a new variable in the dataframe.

``` r
path_df = 
  tibble(
    file_name = list.files("lda_data")
  ) %>% 
  mutate(
    path = str_c("lda_data/", file_name),
    data = map(path, read_csv)
  )
```

Tidy the result.

``` r
study_df = 
  path_df %>% 
  unnest(data) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "observation"
  ) %>% 
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  mutate(
    arm = str_replace(arm, "con", "control"),
    arm = str_replace(arm, "exp", "experimental"),
    arm = as.factor(arm),
    subject_id = as.integer(str_replace(subject_id, ".csv", "")),
    week = as.integer(str_replace(week, "week_", ""))
  )

control_df = filter(study_df,arm == "control")
```

Make a spaghetti plot showing observations on each subject over time.

``` r
study_df %>% 
  ggplot(aes(x = week, y = observation, group = subject_id, color = factor(subject_id))) +
  geom_point() +
  geom_smooth(se = FALSE) +
  labs(
    title = "Observations of control and experimental arms over time",
    x = "Week",
    y = "Observation value",
    caption = "Data from the longitudinal study"
  ) +
  scale_color_hue(name = "Subject ID") +
  facet_grid(. ~ arm)
```

    ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'

<img src="p8105_hw5_cz2612_files/figure-gfm/make plots-1.png" width="90%" />

From the graphs, we could see the over-time trends of observation values
of the control and experimental arms are different. Generally speaking,
the observation values of the control arm fluctuated around the mean
over time, and the observation values of the experimental arm gradually
increased over time.
